# Precision Final Push Configuration
# Based on percentile mode success: P=0.133, R=0.149, F1=0.137
# Target: P≥0.135, R~0.16, F1≥0.145
# Need: +0.002 precision, +0.008 F1

# =============================================================================
# STABLE RATE LIMITING (Anti-Throttling - Proven Settings)
# =============================================================================

# Queue Client Concurrency Control (Critical for USE_BEDROCK_QUEUE=1)
export USE_BEDROCK_QUEUE=1
export ASYNC_MAX_CONCURRENCY=1
export BEDROCK_MAX_CONCURRENCY=1

# Evaluator-Level Rate Limiting (Conservative - Proven to work)
export BEDROCK_MAX_RPS=0.15
export BEDROCK_COOLDOWN_SEC=30
export BEDROCK_RETRY_MAX=8
export BEDROCK_RETRY_BASE=1.8
export BEDROCK_RETRY_MAX_SLEEP=20

# Disable Coverage Rewrite (Major Source of Bedrock Calls)
export RAGCHECKER_COVERAGE_REWRITE=0

# Reduce JSON Usage (Prevent Repair Loops)
export RAGCHECKER_JSON_PROMPTS=0
export RAGCHECKER_JSON_MAX_TOKENS=200

# =============================================================================
# FINAL PUSH PRECISION PARAMETERS
# =============================================================================

# Evidence gate and selection - FINAL PUSH
export RAGCHECKER_EVIDENCE_GUARD=1
export RAGCHECKER_EVIDENCE_JACCARD=0.20
export RAGCHECKER_EVIDENCE_COVERAGE=0.48

# Selection mode - PERCENTILE MODE for recall recovery
export RAGCHECKER_EVIDENCE_KEEP_MODE=percentile
export RAGCHECKER_EVIDENCE_KEEP_PERCENTILE=70

# Weights for evidence scoring - PRECISION BIASED
export RAGCHECKER_WEIGHT_JACCARD=0.30
export RAGCHECKER_WEIGHT_ROUGE=0.35
export RAGCHECKER_WEIGHT_COSINE=0.35

# Diversity/Redundancy caps - TIGHTER FOR PRECISION
export RAGCHECKER_REDUNDANCY_TRIGRAM_MAX=0.42
export RAGCHECKER_PER_CHUNK_CAP=1
export RAGCHECKER_PER_CHUNK_CAP_SMALL=1

# Min/Max sentences for evidence selection - TIGHTER
export RAGCHECKER_EVIDENCE_MIN_SENT=2
export RAGCHECKER_EVIDENCE_MAX_SENT=7

# Claim binding and dropping
export RAGCHECKER_CLAIM_BINDING=1
export RAGCHECKER_DROP_UNSUPPORTED=1

# Generation controls
export RAGCHECKER_CONCISE=1
export RAGCHECKER_MAX_WORDS=700
export RAGCHECKER_REQUIRE_CITATIONS=1

# Semantic features (if available)
export RAGCHECKER_SEMANTIC_FEATURES=1
export RAGCHECKER_USE_EMBED_GUARD=1

# Full evaluation mode
export RAGCHECKER_FAST_MODE=0

# AWS Configuration
export AWS_REGION=us-east-1
export BEDROCK_MODEL_ID=anthropic.claude-3-haiku-20240307-v1:0

# =============================================================================
# CONFIGURATION NOTES
# =============================================================================
# This configuration implements final push precision parameters:
# 1. PERCENTILE mode with 70% threshold (proven to work)
# 2. Tighter evidence thresholds (JACCARD=0.20, COVERAGE=0.48)
# 3. Precision-biased weights (JACCARD=0.30)
# 4. Tighter redundancy caps (0.42)
# 5. Tighter sentence limits (MAX=7)
# 6. Lower word limit (700)
# Expected: P +0.002-0.005 pts, Recall -0.005-0.010 pts, Net F1 ↑
