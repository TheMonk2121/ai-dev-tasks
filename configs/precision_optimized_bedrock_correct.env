# Precision Optimized Bedrock Configuration - CORRECT VARIABLE NAMES
# Based on analysis: Need +1.8 precision points to clear Haiku baseline
# Current: P=0.117, R=0.165, F1=0.133
# Target: P≥0.135, R~0.16, F1≥0.145

# =============================================================================
# STABLE RATE LIMITING (Anti-Throttling - Proven Settings)
# =============================================================================

# Queue Client Concurrency Control (Critical for USE_BEDROCK_QUEUE=1)
export USE_BEDROCK_QUEUE=1
export ASYNC_MAX_CONCURRENCY=1
export BEDROCK_MAX_CONCURRENCY=1

# Evaluator-Level Rate Limiting (Conservative - Proven to work)
export BEDROCK_MAX_RPS=0.15
export BEDROCK_COOLDOWN_SEC=30
export BEDROCK_RETRY_MAX=8
export BEDROCK_RETRY_BASE=1.8
export BEDROCK_RETRY_MAX_SLEEP=20

# Disable Coverage Rewrite (Major Source of Bedrock Calls)
export RAGCHECKER_COVERAGE_REWRITE=0

# Reduce JSON Usage (Prevent Repair Loops)
export RAGCHECKER_JSON_PROMPTS=0
export RAGCHECKER_JSON_MAX_TOKENS=200

# =============================================================================
# PRECISION OPTIMIZATION PARAMETERS (CORRECT RAGCHECKER VARIABLES)
# =============================================================================

# A) Response optimization
export RAGCHECKER_CONCISE=1
export RAGCHECKER_MAX_WORDS=600
export RAGCHECKER_ROBUST_PARSER=1

# B) Evidence and claim optimization
export RAGCHECKER_EVIDENCE_GUARD=1
export RAGCHECKER_CLAIM_BINDING=1
export RAGCHECKER_DROP_UNSUPPORTED=1

# B2) Evidence filter and selection tuning (effective for in-process evaluator)
# Thresholds for evidence gating (precision ↑, minor recall cost)
export RAGCHECKER_EVIDENCE_JACCARD=0.22
export RAGCHECKER_EVIDENCE_COVERAGE=0.50

# Selection strategy: dynamic target-K based on signal strength
export RAGCHECKER_EVIDENCE_KEEP_MODE=target_k
export RAGCHECKER_TARGET_K_WEAK=2
export RAGCHECKER_TARGET_K_BASE=4
export RAGCHECKER_TARGET_K_STRONG=6
export RAGCHECKER_SIGNAL_DELTA_WEAK=0.10
export RAGCHECKER_SIGNAL_DELTA_STRONG=0.22

# Blended scoring weights for sentence selection
export RAGCHECKER_WEIGHT_JACCARD=0.20
export RAGCHECKER_WEIGHT_ROUGE=0.45
export RAGCHECKER_WEIGHT_COSINE=0.35

# Diversity and redundancy controls
export RAGCHECKER_REDUNDANCY_TRIGRAM_MAX=0.40
export RAGCHECKER_PER_CHUNK_CAP=1
export RAGCHECKER_PER_CHUNK_CAP_SMALL=1

# Sentence bounds for kept evidence
export RAGCHECKER_EVIDENCE_MIN_SENT=2
export RAGCHECKER_EVIDENCE_MAX_SENT=8

# C) Semantic features
export RAGCHECKER_SEMANTIC_FEATURES=1
export RAGCHECKER_USE_EMBED_GUARD=1

# D) Evaluation optimization
export RAGCHECKER_USE_ROUGE_L=1
export RAGCHECKER_REQUIRE_CITATIONS=1

# E) Fast mode for precision focus
export RAGCHECKER_FAST_MODE=0

# AWS Configuration
export AWS_REGION=us-east-1
export BEDROCK_MODEL_ID=anthropic.claude-3-haiku-20240307-v1:0

# =============================================================================
# CONFIGURATION NOTES
# =============================================================================
# This configuration uses the actual RAGChecker environment variables:
# 1. RAGCHECKER_CONCISE=1 - Limits response length for precision
# 2. RAGCHECKER_EVIDENCE_GUARD=1 - Guards evidence selection
# 3. RAGCHECKER_CLAIM_BINDING=1 - Binds claims to evidence
# 4. RAGCHECKER_DROP_UNSUPPORTED=1 - Drops unsupported claims
# 5. RAGCHECKER_FAST_MODE=0 - Full evaluation mode (all 15 cases)
# Expected: P +1.0-2.0 pts, Recall -0.2-0.6 pts, Net F1 ↑
